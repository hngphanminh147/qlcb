DROP DATABASE QLCB;

CREATE DATABASE QLCB;
 
USE QLCB;
 
CREATE TABLE KHACHHANG
(
	MAKH NVARCHAR(15) NOT NULL,
	TEN NVARCHAR(15),
	DCHI NVARCHAR(50),
	DTHOAI NVARCHAR(12),
	PRIMARY KEY (MAKH)
);
CREATE TABLE NHANVIEN
(
	MANV NVARCHAR(15) NOT NULL,
	TEN NVARCHAR(15),
	DCHI NVARCHAR(50),
	DTHOAI NVARCHAR(12),
	LUONG DOUBLE,
	LOAINV TINYINT,
	PRIMARY KEY (MANV)
);

CREATE TABLE LOAIMB
(
	HANGSX NVARCHAR(15) NOT NULL,
	MALOAI NVARCHAR(15),
	PRIMARY KEY (MALOAI)
);
CREATE TABLE MAYBAY
(
	MAMB NVARCHAR(15) NOT NULL,
	SOHIEU INT NOT NULL,
	MALOAI NVARCHAR(15) NOT NULL,
	PRIMARY KEY (MAMB)
);
CREATE TABLE CHUYENBAY
(
	MACB NVARCHAR(4) NOT NULL,
	SBDI NVARCHAR(3),
	SBDEN NVARCHAR(3),
	GIODI TIME(6),
	GIODEN TIME(6),
	PRIMARY KEY (MACB)
);
CREATE TABLE LICHBAY
(
	MALB NVARCHAR(15) NOT NULL,
	NGAYDI DATE NOT NULL,
	MACB NVARCHAR(4) NOT NULL,
	SOHIEU INT,
	MALOAI NVARCHAR(15),
	PRIMARY KEY (MALB)
);
CREATE TABLE DATCHO
(
	MADC NVARCHAR(15) NOT NULL,
	MAKH NVARCHAR(15) NOT NULL,
	NGAYDI DATE NOT NULL,
	MACB NVARCHAR(4) NOT NULL,
	PRIMARY KEY (MADC)
);
CREATE TABLE KHANANG
(
	MAKN NVARCHAR(15) NOT NULL,
	MANV NVARCHAR(15) NOT NULL,
	MALOAI NVARCHAR(15) NOT NULL,
	PRIMARY KEY (MAKN)
);	
CREATE TABLE PHANCONG
(
	MAPC NVARCHAR(15) NOT NULL,
	MANV NVARCHAR(15) NOT NULL,
	-- NGAYDI DATETIME(3) NOT NULL,
	NGAYDI DATE NOT NULL,
	MACB NVARCHAR(4) NOT NULL,
	PRIMARY KEY (MAPC)
);

ALTER TABLE DATCHO
ADD CONSTRAINT FK_DATCHO_KHACHHANG
FOREIGN KEY (MAKH)
REFERENCES KHACHHANG(MAKH);

-- ALTER TABLE DATCHO
-- ADD CONSTRAINT FK_DATCHO_LICHBAY
-- FOREIGN KEY (NGAYDI, MACB)
-- REFERENCES LICHBAY(NGAYDI, MACB);

ALTER TABLE DATCHO
ADD CONSTRAINT FK_DATCHO_LICHBAY
FOREIGN KEY (NGAYDI, MACB)
REFERENCES LICHBAY(NGAYDI, MACB);

ALTER TABLE DATCHO
ADD CONSTRAINT FK_DATCHO_LICHBAY
FOREIGN KEY (NGAYDI, MACB)
REFERENCES LICHBAY(NGAYDI, MACB);

ALTER TABLE LICHBAY
ADD CONSTRAINT FK_LICHBAY_CHUYENBAY
FOREIGN KEY (MACB)
REFERENCES CHUYENBAY(MACB);

ALTER TABLE LICHBAY
ADD CONSTRAINT FK_LICHBAY_MAYBAY
FOREIGN KEY (SOHIEU, MALOAI)
REFERENCES MAYBAY(SOHIEU, MALOAI);

ALTER TABLE MAYBAY
ADD CONSTRAINT FK_MAYBAY_LOAIMB
FOREIGN KEY (MALOAI)
REFERENCES LOAIMB(MALOAI);

ALTER TABLE KHANANG
ADD CONSTRAINT FK_KHANANG_LOAIMB
FOREIGN KEY (MALOAI)
REFERENCES LOAIMB(MALOAI);

ALTER TABLE KHANANG
ADD CONSTRAINT FK_KHANANG_NHANVIEN
FOREIGN KEY (MANV)
REFERENCES NHANVIEN(MANV);

ALTER TABLE PHANCONG
ADD CONSTRAINT FK_PHANCONG_NHANVIEN
FOREIGN KEY (MANV)
REFERENCES NHANVIEN(MANV);

ALTER TABLE PHANCONG
ADD CONSTRAINT FK_PHANCONG_LICHBAY
FOREIGN KEY (NGAYDI, MACB)
REFERENCES LICHBAY(NGAYDI, MACB);

INSERT INTO NHANVIEN VALUES
('1001','Huong','8 Dien Bien Phu','8330733',500000,1),
('1002','Phong','1 Ly Thuong Kiet','8308117',450000,1),
('1003','Huong','8 Dien Bien Phu','8330733',500000,1),
('1004','Huong','8 Dien Bien Phu','8330733',500000,1),
('1005','Giao','65 Nguyen Thai Son','8324467',500000,0),
('1006','Chi','12/6,Nguyen Kiem','8120012',150000,0),
('1007','Huong','8 Dien Bien Phu','8330733',500000,1);

INSERT INTO KHACHHANG VALUES
('0009','Nga','223 Nguyen Trai','8932320'),
('0101','Anh','567 Tran Phu','8826729'),
('0045','Thu','285 Le Loi','8932203'),
('0012','Ha','435 Quang Trung','8933232'),
('0238','Hung','456 Pasteur','9812101'),
('0397','Thanh','234 Le Van Si','8952943'),
('0582','Mai','789 Nguyen Du',NULL),
('0934','Minh','678 Le Lai',NULL),
('0091','Hai','345 Hung Vuong','8893223'),
('0314','Phuong','395 Vo Van Tan','8232320'),
('0613','Vu','348 CMT8','8343232'),
('0586','Son','123 Bach Dang','8556223'),
('0422','Tien','75 Nguyen Thong','8332222');

INSERT INTO CHUYENBAY VALUES
('0001', '100','SLC','BOS','08:00','17:50'),
('0002', '112','DCA','DEN','14:00','18:07'),
('0003', '121','STL','SLC','07:00','09:13'),
('0004', '122','STL','YYV','08:30','10:19'),
('0005', '206','DFW','STL','09:00','11:40'),
('0006', '330','JFK','YYV','16:00','18:53'),
('0007', '334','ORD','MIA','12:00','14:14'),
('0008', '335','MIA','ORD','15:00','17:14'),
('0009', '336','ORD','MIA','18:00','20:14'),
('0010', '337','MIA','ORD','20:30','23:53'),
('0011', '394','DFW','MIA','19:00','21:30'),
('0012', '395','MIA','DFW','21:00','23:43'),
('0013', '449','CDG','DEN','10:00','19:29'),
('0014', '930','YYV','DCA','13:00','16:10'),
('0015', '931','DCA','YYV','17:00','18:10'),
('0016', '932','DCA','YYV','18:00','19:10'),
('0017', '991','BOS','ORD','17:00','18:22');

INSERT INTO LOAIMB VALUES
('Airbus','A310'),
('Airbus','A320'),
('Airbus','A330'),
('Airbus','A340'),
('Boeing','B727'),
('Boeing','B747'),
('Boeing','B757'),
('MD','DC10'),
('MD','DC9');

INSERT INTO MAYBAY VALUES
('0001', 10,'B747'),
('0002', 11,'B727'),
('0003', 13,'B727'),
('0004', 13,'B747'),
('0005', 21,'DC10'),
('0006', 21,'DC9'),
('0007', 22,'B757'),
('0008', 22,'DC9'),
('0009', 23,'DC9'),
('0010', 24,'DC9'),
('0011', 70,'A310'),
('0012', 80,'A310'),
('0013', 93,'B757');

INSERT INTO LICHBAY VALUES
('0001', "2000-11-01",'100',80,'A310'),
('0002', "2000-11-01",'112',21,'DC10'),
('0003', "2000-11-01",'206',22,'DC9'),
('0004', "2000-11-01",'334',10,'B747'),
('0005', "2000-11-01",'395',23,'DC9'),
('0006', "2000-11-01",'991',22,'B757'),
('0007', "2000-11-01",'337',10,'B747'),
('0008', "2000-10-31",'100',11,'B727'),
('0009', "2000-10-31",'112',11,'B727'),
('0010', "2000-10-31",'206',13,'B727'),
('0011', "2000-10-31",'334',10,'B747'),
('0012', "2000-10-31",'335',10,'B747'),
('0013', "2000-10-31",'337',24,'DC9'),
('0014', "2000-10-31",'449',70,'A310');

INSERT INTO DATCHO VALUES
('0001', '0009',"2000-11-01",'100'),
('0002', '0009',"2000-10-31",'449'),
('0003', '0045',"2000-11-01",'991'),
('0004', '0012',"2000-10-31",'206'),
('0005', '0238',"2000-10-31",'334'),
('0006', '0582',"2000-11-01",'991'),
('0007', '0091',"2000-11-01",'100'),
('0008', '0314',"2000-10-31",'449'),
('0009', '0613',"2000-11-01",'100'),
('0010', '0586',"2000-11-01",'991'),
('0011', '0586',"2000-10-31",'100'),
('0012', '0422',"2000-10-31",'449');

INSERT INTO PHANCONG VALUES
('0001', '1001',"2000-11-01",'100'),
('0002', '1001',"2000-10-31",'100'),
('0003', '1002',"2000-11-01",'100'),
('0004', '1002',"2000-10-31",'100'),
('0005', '1003',"2000-10-31",'100'),
('0006', '1003',"2000-10-31",'337'),
('0007', '1004',"2000-10-31",'100'),
('0008', '1004',"2000-10-31",'337'),
('0009', '1005',"2000-10-31",'337'),
('0010', '1006',"2000-11-01",'991'),
('0011', '1006',"2000-10-31",'337'),
('0012', '1007',"2000-11-01",'112'),
('0013', '1007',"2000-11-01",'991'),
('0014', '1007',"2000-10-31",'206');

INSERT INTO KHANANG VALUES
('0001', '1001','B727'),
('0002', '1001','DC9'),
('0003', '1002','B747'),
('0004', '1002','A310'),
('0005', '1003','DC10'),
('0006', '1003','DC9'),
('0007', '1004','DC9'),
('0008', '1004','A320'),
('0009', '1007','A340'),
('0010', '1007','B757');